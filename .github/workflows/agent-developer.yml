name: Developer Agent - Autonomous Code Generation

on:
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'GitHub Issue number to implement'
        required: true
        type: string

jobs:
  autonomous-development:
    runs-on: ubuntu-latest  # Use Linux for the "Brain" to save costs/time

    permissions:
      contents: write       # Create branches and commits
      pull-requests: write  # Create and update PRs
      issues: write         # Comment on issues

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Full history for proper git operations

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r Agents/requirements.txt

      - name: Configure Git
        run: |
          git config --global user.name "Developer Agent"
          git config --global user.email "devagent@signlanguagemodel.spsarolkar.in"

      - name: Run Developer Agent
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          ISSUE_NUMBER: ${{ inputs.issue_number }}
          GITHUB_ACTOR: ${{ github.actor }}
        run: |
          python Agents/developer_agent.py "${{ inputs.issue_number }}"

      - name: Upload Agent Logs
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: developer-agent-logs
          path: |
            developer_agent.log
            agent_output.json
          if-no-files-found: ignore
